<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Paxos Algorithm Note | â€‹Tech and Text Tales</title>
<meta name=keywords content="algorithm,paxos"><meta name=description content="å­¦ä¹  PaxosStore ä¸­çš„ Paxos å®ç°ã€‚"><meta name=author content="Chang Liu"><link rel=canonical href=https://www.liuchang0812.com/posts/tech/os/paxos-note/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.liuchang0812.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.liuchang0812.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.liuchang0812.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.liuchang0812.com/apple-touch-icon.png><link rel=mask-icon href=https://www.liuchang0812.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.liuchang0812.com/posts/tech/os/paxos-note/><link rel=stylesheet href=/gitalk.css><script src=/gitalk.min.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Paxos Algorithm Note"><meta property="og:description" content="å­¦ä¹  PaxosStore ä¸­çš„ Paxos å®ç°ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://www.liuchang0812.com/posts/tech/os/paxos-note/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-26T20:02:45+08:00"><meta property="article:modified_time" content="2022-06-26T20:02:45+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Paxos Algorithm Note"><meta name=twitter:description content="å­¦ä¹  PaxosStore ä¸­çš„ Paxos å®ç°ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.liuchang0812.com/posts/"},{"@type":"ListItem","position":2,"name":"Paxos Algorithm Note","item":"https://www.liuchang0812.com/posts/tech/os/paxos-note/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Paxos Algorithm Note","name":"Paxos Algorithm Note","description":"å­¦ä¹  PaxosStore ä¸­çš„ Paxos å®ç°ã€‚","keywords":["algorithm","paxos"],"articleBody":"Paxos åè®®ä¸å·¥ç¨‹å®ç° å†™åœ¨å‰é¢ï¼Œæˆ‘æ²¡æœ‰å®Œæ•´å®ç°è¿‡ Paxos åè®®ï¼Œä¸æ•¢ä¿è¯ä¸‹é¢æè¿°çš„å†…å®¹å®Œå…¨æ­£ç¡®ã€‚æœ¬æ–‡ä¸»è¦æ˜¯å­¦ä¹ çš„ç¬”è®°ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œååˆ†æ¬¢è¿æŒ‡å‡ºï¼Œå¤§å®¶ä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚\næœ¬æ–‡æ‰€æœ‰å†…å®¹éƒ½æ˜¯å‚è€ƒ PaxosStore è®ºæ–‡ ã€ŠPaxosStore: High-availability Storage Made Practical in WeChatã€‹\næ¦‚å¿µå®šä¹‰ ä¸ºäº†åç»­æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¼šç”¨åˆ°çš„æ¦‚å¿µ\nProposal æè®®ï¼ŒåŒ…å«æè®®å·å’Œæè®®å€¼ï¼› Prepare ç¬¬ä¸€é˜¶æ®µ Proposer å‘å‡ºçš„è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·ï¼› Promise ç¬¬ä¸€é˜¶æ®µ Proposer å›åº”çš„æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·å’Œä¸€ä¸ªï¼ˆå¦‚æœæœ‰ï¼‰å·²ç» Accepted çš„æœ€å¤§æä»ªï¼› Accept ç¬¬äºŒé˜¶æ®µ Proposer å‘å‡ºçš„è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·å’Œä¸€ä¸ªæè®®å€¼ï¼› Accepted ç¬¬äºŒé˜¶æ®µ Proposer å›åº”çš„æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·ã€‚ä¹Ÿè¡¨ç¤ºä¸€ä¸ªæè®®è¢«ä¸€ä¸ªè¯¥ Proposer æ¥å—ï¼› Chosen ä»£è¡¨ä¸€ä¸ªæè®®è¢«å¤§å¤šæ•°çš„ Proposer æ¥å—ï¼Œä¸ä¼šå†å‘ç”Ÿæ”¹å˜ï¼› Proposer æè®®æˆå‘˜ï¼› Acceptor å‘é€ Accepted æ¶ˆæ¯çš„æˆå‘˜ï¼› Learner å­¦ä¹ è€…ï¼Œä¸å‚ä¸ Paxos æŠ•ç¥¨è¿‡ç¨‹ã€‚ ä¸å¯ä»¥ç”¨ä»£ç è¯­è¨€æè¿°ï¼Œå‚è€ƒ é“¾æ¥\n// Prepare è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å· struct Prepare { int n; }; // åœ¨æ”¶åˆ°å¤§å¤šæ•°çš„ Promised è¯·æ±‚åï¼Œå‘å‡ºçš„ Accept è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæä»ªå·ä»¥åŠä¸€ä¸ªå€¼ã€‚ // è¿™ä¸ªå€¼æ˜¯ Promised ä¸­æœ€å¤§æè®®å·çš„å€¼ï¼Œå¦‚æœæ‰€æœ‰ promised éƒ½æ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™å¯ä»¥è‡ªå·±æå‡ºä»»æ„å€¼ã€‚ // å¯¹åº”åˆ°å·¥ç¨‹å®ç°ä¸Šï¼Œåˆ™ä»£è¡¨è¿™ä¸ªä½ç½®å·²ç»è¢«å äº†ï¼Œå¯ä»¥å†èµ·ä¸€è½®æ–° paxos struct Accept { int n; void *value; }; // n æ‰¿è¯ºä¸ accept å°äº n çš„ accept è¯·æ±‚ï¼Œè¿”å›å½“æ—¶æœ€å¤§æè®®å·å¯¹åº”çš„å€¼ã€‚ struct Promised { int n; Accept *proposal = nullptr; }; // å¦‚æœæ»¡è¶³æ‰¿è¯ºï¼Œè¿”å›æœ€å¤§çš„æè®®å· struct Accepted { int n; }; // paxos æˆå‘˜ä¼šåœ¨å†…å­˜ä¸­çºªå½•çš„å€¼ï¼ŒåŒ…æ‹¬æœ€å¤§çš„æè®®å·ï¼Œä»¥åŠå¯¹åº”çš„å€¼ã€‚ class Acceptor { int last_n = 0; Accept *proposal = nullptr; }; Basic Paxos åè®® Basic Paxos æ˜¯ç†è®ºä¸Šçš„æœ€åŸºç¡€çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œä½œç”¨æ˜¯ï¼šå¤šä¸ªï¼ˆå¥‡æ•°ï¼‰æˆå‘˜ç¡®å®šå”¯ä¸€ä¸€ä¸ªå€¼ã€‚\nç®—æ³•åˆ†ä¸ºä¸¤è½®ï¼Œç¬¬ä¸€è½® Prepare è¯·æ±‚ä¼šå¾—åˆ°æ‰¿è¯ºåç»­ä¸é€šè¿‡å°äºæœ¬æ¬¡ Prepare.n çš„æè®®ï¼ŒåŒæ—¶è¿”å›è‡ªå·±å·²ç» accepted çš„æœ€å¤§æè®®ã€‚ç¬¬äºŒè½® Accept è¯·æ±‚ä¼šå¸¦ä¸Šä¸Šä¸€è½®æ”¶åˆ°çš„æœ€å¤§æè®®å€¼ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¯ä»¥è‡ªå·±æå‡ºï¼‰ï¼Œæ¯ä¸ª Acceptor åœ¨ä¸è¿èƒŒæ‰¿è¯ºçš„æƒ…å†µä¸‹æ›´æ–°æœ¬åœ°çŠ¶æ€ã€‚\nä¸€ä¸ªæä»ªä¸€æ—¦è¢«å¤§å¤šæ•°ç»“æœ acceptedï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯ chosenã€‚å¯¹äºä¸€ä¸ªå€¼æ¥è¯´ï¼Œaccepted è¿˜æ˜¯å¯ä»¥å˜çš„ï¼Œchosen çš„æ°¸è¿œä¸ä¼šå˜ã€‚ä¸€ç»„ç»å…¸çš„ paxos å®ä¾‹åªèƒ½ç¡®å®šï¼ˆchosenï¼‰ä¸€ä¸ªå€¼ã€‚\nç®—æ³•çš„è¯¦ç»†æè¿°å¯ä»¥å‚è€ƒè®ºæ–‡ï¼š\nPhase 1.\nA proposer selects a proposal numberÂ nÂ and sends a prepare request with numberÂ nÂ to a majority of acceptors.\nIf an acceptor receives a prepare request with numberÂ nÂ greater than that of any prepare request to which it has already responded, then it responds to the request with a promise not to accept any more proposals numbered less thanÂ nÂ and with the highest-numbered proposal (if any) that it has accepted.\nPhase 2.\nIf the proposer receives a response to its prepare requests (numberedÂ n) from a majority of acceptors, then it sends an accept request to each of those acceptors for a proposal numberedÂ nÂ with a valueÂ v, whereÂ v is the value of the highest-numbered proposal among the responses, or is any value if the responses reported no proposals.\nIf an acceptor receives an accept request for a proposal numberedÂ n, it accepts the proposal unless it has already responded to a prepare request having a number greater thanÂ n.\næ³¨æ„ç»†èŠ‚ï¼š\nAccept è¯·æ±‚ä¸­çš„ value æ˜¯ä¸€é˜¶æ®µè¿”å›æ‰€æœ‰ promised ä¸­ n æœ€å¤§çš„é‚£ä¸ªå€¼ã€‚æ˜¯ promisedâ†’proposal.n çš„ nï¼Œè€Œä¸æ˜¯ promised.n acceptor ä¸Š accept å€¼è¿˜æ˜¯ä¼šè¢«ä¿®æ”¹çš„ã€‚ åœ¨æè®®è¢«å¤§å¤šæ•°é€šè¿‡çš„ä¸€ç¬é—´ï¼Œè¿™ä¸ªå€¼å°±ç¡®å®šä¸‹æ¥äº†ï¼Œå†ä¹Ÿä¸ä¼šè¢«ä¿®æ”¹ã€‚ å¯¹äºè¯æ˜çš„æ€è·¯æ˜¯è¿™ä¹ˆä¸€ç§æ€è·¯ï¼šè¯æ˜ä¸€ä¸ªå€¼ chosen ä¸ä¼šè¢«ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡åŠ å¼ºçš„æ–¹å¼ã€‚å¦‚æœä¸€ä¸ªå¤§äºå½“å‰æä»ªå·å¹¶ä¸”å€¼ä¸åŒçš„æä»ªï¼Œä¸ä¼šè¢«å‘å‡ºã€‚chosen çš„å€¼è‡ªç„¶å°±ä¸ä¼šè¢«ä¿®æ”¹ã€‚\nMulti Paxos å®ç°æ–¹æ³• å¯ä»¥çœ‹åˆ°ï¼ŒBasic Paxos ç®—æ³•åªèƒ½ç¡®å®šä¸€ä¸ªå€¼ï¼ŒåŒæ—¶è¦èµ°ä¸¤è½®æµç¨‹ã€‚ä¸ºäº†åœ¨çœŸå®ç³»ç»Ÿä¸Šå®é™…ä½¿ç”¨èµ·æ¥ï¼Œè¿˜éœ€è¦åšä¸€äº›ä¿®æ”¹ä¼˜åŒ–ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨ Basic Paxos ä¸Šå¢åŠ ä¸€ä¸ª Entry ID çš„ç»´åº¦ï¼Œæ¯ä¸ª Entry ä¿å­˜ä¸€ä¸ªå€¼ã€‚åŒæ—¶ï¼Œå¯ä»¥åœ¨ç¬¬ i ä¸ª Entry ä¸­æºå¸¦ä¸Šç¬¬ i+1 ä¸ª Entry çš„ Prepare ä¿¡æ¯ï¼šå½“ $E_i$ è¢« chosen æ—¶ï¼ŒåŒæ—¶è®¤ä¸º $E_i+1$ å·²ç»å®Œæˆäº† prepare æµç¨‹ã€‚\nå·¥ç¨‹å®ç°ä¸Šçš„é—®é¢˜ è®ºæ–‡åªæè¿°äº† Paxos ç®—æ³•çš„æµç¨‹å’Œè¯æ˜ï¼Œåœ¨å®é™…å®ç°ä¸Šï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚è¦å¤„ç†ï¼Œä¾‹å¦‚æ€ä¹ˆ CatchUpã€æ€ä¹ˆ GetALLä»¥åŠä¸€äº›ç»†èŠ‚çš„é—®é¢˜ã€‚\nå†™è¯»è¯»é—®é¢˜ å†™è¯»è¯»çš„é—®é¢˜åœºæ™¯ï¼šå‡è®¾ä¸‰æœºæ—¥å¿—éƒ½commitåˆ°äº†Entry 100ï¼Œç„¶åæœºå™¨ Aæ‰§è¡Œ Entry 101 çš„äºŒè½®è¿‡ç¨‹ç„¶åæŒ‚æ‰ã€‚è¿™ä¸ªæ—¶å€™ä¼šè¯»åˆ° 100 çš„å€¼ã€‚ç„¶åæœºå™¨ A æ¢å¤åŒæ­¥çŠ¶æ€åˆ° BCï¼Œåç»­å°±è¯»åˆ°äº† Entry 101ã€‚\né‡å¤æ‰§è¡Œé—®é¢˜ é‡å¤æ‰§è¡Œçš„é—®é¢˜åœºæ™¯ï¼šæœºå™¨ A æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚ï¼Œåœ¨æ‰§è¡Œå®Œ Paxos åè¢« chosenï¼Œç„¶åå‘é€å“åº”ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªå“åº”å¯èƒ½å› ä¸ºç½‘ç»œåŸå› æœªå‘åˆ°æˆ–è€…è¶…æ—¶ã€‚ç„¶åå®¢æˆ·ç«¯è¶…æ—¶åé‡å‘è¯·æ±‚åˆ°æœºå™¨ Bã€‚æœºå™¨ B é‡æ–°è·‘ä¸€æ¬¡ Paxos è¿‡ç¨‹ï¼Œç„¶åå›å¤å®¢æˆ·ç«¯ã€‚è¿™å„¿æ›´æ–°è¿‡ç¨‹å°±ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œå¦‚æœæ˜¯æœ‰çŠ¶æ€çš„æ›´æ–°å°±ä¼šæœ‰é—®é¢˜ã€‚\næ‰€ä»¥è¦è®©è¯·æ±‚å¹‚ç­‰ï¼Œæ–¹æ³•å°±æ˜¯åœ¨è¯·æ±‚ä¸Šå¸¦ä¸Š request IDï¼Œ svr ç«¯æ£€æŸ¥ request ID ã€‚\nThe request ID is generated by the client and sent together with the write request, and checked by the PaxosStore node to detect potential duplication of actual request handling.\nPlogKV å®ç°é—®é¢˜ æ–‡ç« åŒæ—¶æåˆ°äº†ä¸€ä¸ª PaxosLog for KV Dataï¼Œå¯ä»¥ä¼˜åŒ–æ‰ DB éƒ¨åˆ†çš„æˆæœ¬ã€‚é‚£ä¹ˆæ­£å¸¸çš„plogå­˜å‚¨çš„keyåº”è¯¥æ˜¯entityidå’Œentryidï¼Ÿæ€ä¹ˆç”¨keyæ¥æŸ¥è¯¢ï¼Ÿ\nç­”æ¡ˆæ˜¯åªç»´æŠ¤ä¸¤ä¸ªentryï¼Œä¸€ä¸ªæœ€æ–°chosenï¼Œä¸€ä¸ªpendingã€‚æ¯ä¸ª key éƒ½æ˜¯ä¸€ä¸ª paxos å®ä¾‹ã€‚\nå‚è€ƒ https://sf-zhou.github.io/paxos/paxos_store_03_consensus.html http://www.vldb.org/pvldb/vol10/p1730-lin.pdf ","wordCount":"1785","inLanguage":"en","datePublished":"2022-06-26T20:02:45+08:00","dateModified":"2022-06-26T20:02:45+08:00","author":[{"@type":"Person","name":"Chang Liu"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.liuchang0812.com/posts/tech/os/paxos-note/"},"publisher":{"@type":"Organization","name":"â€‹Tech and Text Tales","logo":{"@type":"ImageObject","url":"https://www.liuchang0812.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.liuchang0812.com/ accesskey=h title="â€‹Tech and Text Tales (Alt + H)">â€‹Tech and Text Tales</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.liuchang0812.com/posts title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://www.liuchang0812.com/search/ title=ğŸ”æœç´¢><span>ğŸ”æœç´¢</span></a></li><li><a href=https://www.liuchang0812.com/archives/ title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://www.liuchang0812.com/about/ title=ğŸ™‹ğŸ»â€â™‚ï¸å…³äº><span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.liuchang0812.com/>Home</a>&nbsp;Â»&nbsp;<a href=https://www.liuchang0812.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Paxos Algorithm Note</h1><div class=post-description>å­¦ä¹  PaxosStore ä¸­çš„ Paxos å®ç°ã€‚</div><div class=post-meta><span title='2022-06-26 20:02:45 +0800 +0800'>2022-06-26</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;Chang Liu</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#paxos-%e5%8d%8f%e8%ae%ae%e4%b8%8e%e5%b7%a5%e7%a8%8b%e5%ae%9e%e7%8e%b0 aria-label="Paxos åè®®ä¸å·¥ç¨‹å®ç°">Paxos åè®®ä¸å·¥ç¨‹å®ç°</a></li><li><a href=#%e6%a6%82%e5%bf%b5%e5%ae%9a%e4%b9%89 aria-label=æ¦‚å¿µå®šä¹‰>æ¦‚å¿µå®šä¹‰</a></li><li><a href=#basic-paxos-%e5%8d%8f%e8%ae%ae aria-label="Basic Paxos åè®®">Basic Paxos åè®®</a></li><li><a href=#multi-paxos-%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%b3%95 aria-label="Multi Paxos å®ç°æ–¹æ³•">Multi Paxos å®ç°æ–¹æ³•</a></li><li><a href=#%e5%b7%a5%e7%a8%8b%e5%ae%9e%e7%8e%b0%e4%b8%8a%e7%9a%84%e9%97%ae%e9%a2%98 aria-label=å·¥ç¨‹å®ç°ä¸Šçš„é—®é¢˜>å·¥ç¨‹å®ç°ä¸Šçš„é—®é¢˜</a><ul><li><a href=#%e5%86%99%e8%af%bb%e8%af%bb%e9%97%ae%e9%a2%98 aria-label=å†™è¯»è¯»é—®é¢˜>å†™è¯»è¯»é—®é¢˜</a></li><li><a href=#%e9%87%8d%e5%a4%8d%e6%89%a7%e8%a1%8c%e9%97%ae%e9%a2%98 aria-label=é‡å¤æ‰§è¡Œé—®é¢˜>é‡å¤æ‰§è¡Œé—®é¢˜</a></li></ul></li><li><a href=#plogkv-%e5%ae%9e%e7%8e%b0%e9%97%ae%e9%a2%98 aria-label="PlogKV å®ç°é—®é¢˜">PlogKV å®ç°é—®é¢˜</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=å‚è€ƒ>å‚è€ƒ</a></li></ul></div></details></div><div class=post-content><h1 id=paxos-åè®®ä¸å·¥ç¨‹å®ç°>Paxos åè®®ä¸å·¥ç¨‹å®ç°<a hidden class=anchor aria-hidden=true href=#paxos-åè®®ä¸å·¥ç¨‹å®ç°>#</a></h1><blockquote><p>å†™åœ¨å‰é¢ï¼Œæˆ‘æ²¡æœ‰å®Œæ•´å®ç°è¿‡ Paxos åè®®ï¼Œä¸æ•¢ä¿è¯ä¸‹é¢æè¿°çš„å†…å®¹å®Œå…¨æ­£ç¡®ã€‚æœ¬æ–‡ä¸»è¦æ˜¯å­¦ä¹ çš„ç¬”è®°ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œååˆ†æ¬¢è¿æŒ‡å‡ºï¼Œå¤§å®¶ä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚</p></blockquote><blockquote><p>æœ¬æ–‡æ‰€æœ‰å†…å®¹éƒ½æ˜¯å‚è€ƒ <a href=http://www.vldb.org/pvldb/vol10/p1730-lin.pdf>PaxosStore</a> è®ºæ–‡ ã€ŠPaxosStore: High-availability Storage Made Practical in WeChatã€‹</p></blockquote><h1 id=æ¦‚å¿µå®šä¹‰>æ¦‚å¿µå®šä¹‰<a hidden class=anchor aria-hidden=true href=#æ¦‚å¿µå®šä¹‰>#</a></h1><p>ä¸ºäº†åç»­æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¼šç”¨åˆ°çš„æ¦‚å¿µ</p><ul><li>Proposal æè®®ï¼ŒåŒ…å«æè®®å·å’Œæè®®å€¼ï¼›</li><li>Prepare ç¬¬ä¸€é˜¶æ®µ Proposer å‘å‡ºçš„è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·ï¼›</li><li>Promise ç¬¬ä¸€é˜¶æ®µ Proposer å›åº”çš„æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·å’Œä¸€ä¸ªï¼ˆå¦‚æœæœ‰ï¼‰å·²ç» Accepted çš„æœ€å¤§æä»ªï¼›</li><li>Accept ç¬¬äºŒé˜¶æ®µ Proposer å‘å‡ºçš„è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·å’Œä¸€ä¸ªæè®®å€¼ï¼›</li><li>Accepted ç¬¬äºŒé˜¶æ®µ Proposer å›åº”çš„æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·ã€‚ä¹Ÿè¡¨ç¤ºä¸€ä¸ªæè®®è¢«ä¸€ä¸ªè¯¥ Proposer æ¥å—ï¼›</li><li>Chosen ä»£è¡¨ä¸€ä¸ªæè®®è¢«å¤§å¤šæ•°çš„ Proposer æ¥å—ï¼Œä¸ä¼šå†å‘ç”Ÿæ”¹å˜ï¼›</li><li>Proposer æè®®æˆå‘˜ï¼›</li><li>Acceptor å‘é€ Accepted æ¶ˆæ¯çš„æˆå‘˜ï¼›</li><li>Learner å­¦ä¹ è€…ï¼Œä¸å‚ä¸ Paxos æŠ•ç¥¨è¿‡ç¨‹ã€‚</li></ul><p>ä¸å¯ä»¥ç”¨ä»£ç è¯­è¨€æè¿°ï¼Œå‚è€ƒ <a href=https://sf-zhou.github.io/paxos/paxos_store_03_consensus.html>é“¾æ¥</a></p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#007f7f>// Prepare è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæè®®å·
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>struct</span> Prepare {
</span></span><span style=display:flex><span>  <span style=color:#fff;font-weight:700>int</span> n;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f>// åœ¨æ”¶åˆ°å¤§å¤šæ•°çš„ Promised è¯·æ±‚åï¼Œå‘å‡ºçš„ Accept è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ªæä»ªå·ä»¥åŠä¸€ä¸ªå€¼ã€‚
</span></span></span><span style=display:flex><span><span style=color:#007f7f>// è¿™ä¸ªå€¼æ˜¯ Promised ä¸­æœ€å¤§æè®®å·çš„å€¼ï¼Œå¦‚æœæ‰€æœ‰ promised éƒ½æ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™å¯ä»¥è‡ªå·±æå‡ºä»»æ„å€¼ã€‚
</span></span></span><span style=display:flex><span><span style=color:#007f7f>// å¯¹åº”åˆ°å·¥ç¨‹å®ç°ä¸Šï¼Œåˆ™ä»£è¡¨è¿™ä¸ªä½ç½®å·²ç»è¢«å äº†ï¼Œå¯ä»¥å†èµ·ä¸€è½®æ–° paxos
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>struct</span> Accept {
</span></span><span style=display:flex><span>  <span style=color:#fff;font-weight:700>int</span> n;
</span></span><span style=display:flex><span>  <span style=color:#fff;font-weight:700>void</span> *value;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f>// n æ‰¿è¯ºä¸ accept å°äº n çš„ accept è¯·æ±‚ï¼Œè¿”å›å½“æ—¶æœ€å¤§æè®®å·å¯¹åº”çš„å€¼ã€‚
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>struct</span> Promised {
</span></span><span style=display:flex><span>  <span style=color:#fff;font-weight:700>int</span> n;
</span></span><span style=display:flex><span>  Accept *proposal = <span style=color:#fff;font-weight:700>nullptr</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f>// å¦‚æœæ»¡è¶³æ‰¿è¯ºï¼Œè¿”å›æœ€å¤§çš„æè®®å·
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>struct</span> Accepted {
</span></span><span style=display:flex><span>  <span style=color:#fff;font-weight:700>int</span> n;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f>// paxos æˆå‘˜ä¼šåœ¨å†…å­˜ä¸­çºªå½•çš„å€¼ï¼ŒåŒ…æ‹¬æœ€å¤§çš„æè®®å·ï¼Œä»¥åŠå¯¹åº”çš„å€¼ã€‚
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>class</span> Acceptor {
</span></span><span style=display:flex><span>  <span style=color:#fff;font-weight:700>int</span> last_n = <span style=color:#ff0;font-weight:700>0</span>;
</span></span><span style=display:flex><span>  Accept *proposal = <span style=color:#fff;font-weight:700>nullptr</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h1 id=basic-paxos-åè®®>Basic Paxos åè®®<a hidden class=anchor aria-hidden=true href=#basic-paxos-åè®®>#</a></h1><p><code>Basic Paxos</code> æ˜¯ç†è®ºä¸Šçš„æœ€åŸºç¡€çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œä½œç”¨æ˜¯ï¼š<strong>å¤šä¸ªï¼ˆå¥‡æ•°ï¼‰æˆå‘˜ç¡®å®šå”¯ä¸€ä¸€ä¸ªå€¼ã€‚</strong></p><p>ç®—æ³•åˆ†ä¸ºä¸¤è½®ï¼Œç¬¬ä¸€è½® Prepare è¯·æ±‚ä¼šå¾—åˆ°æ‰¿è¯ºåç»­ä¸é€šè¿‡å°äºæœ¬æ¬¡ Prepare.n çš„æè®®ï¼ŒåŒæ—¶è¿”å›è‡ªå·±å·²ç» accepted çš„æœ€å¤§æè®®ã€‚ç¬¬äºŒè½® Accept è¯·æ±‚ä¼šå¸¦ä¸Šä¸Šä¸€è½®æ”¶åˆ°çš„æœ€å¤§æè®®å€¼ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¯ä»¥è‡ªå·±æå‡ºï¼‰ï¼Œæ¯ä¸ª Acceptor åœ¨ä¸è¿èƒŒæ‰¿è¯ºçš„æƒ…å†µä¸‹æ›´æ–°æœ¬åœ°çŠ¶æ€ã€‚</p><p>ä¸€ä¸ªæä»ªä¸€æ—¦è¢«å¤§å¤šæ•°ç»“æœ acceptedï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯ chosenã€‚å¯¹äºä¸€ä¸ªå€¼æ¥è¯´ï¼Œaccepted è¿˜æ˜¯å¯ä»¥å˜çš„ï¼Œchosen çš„æ°¸è¿œä¸ä¼šå˜ã€‚ä¸€ç»„ç»å…¸çš„ paxos å®ä¾‹åªèƒ½ç¡®å®šï¼ˆchosenï¼‰ä¸€ä¸ªå€¼ã€‚</p><p>ç®—æ³•çš„è¯¦ç»†æè¿°å¯ä»¥å‚è€ƒè®ºæ–‡ï¼š</p><p><strong>Phase 1.</strong></p><ol><li><p>A proposer selects a proposal numberÂ nÂ and sends a prepare request with numberÂ nÂ to a majority of acceptors.</p></li><li><p>If an acceptor receives a prepare request with numberÂ nÂ greater than that of any prepare request to which it has already responded, then it responds to the request with a promise not to accept any more proposals numbered less thanÂ nÂ and with the highest-numbered proposal (if any) that it has accepted.</p></li></ol><p><strong>Phase 2.</strong></p><ol><li><p>If the proposer receives a response to its prepare requests (numberedÂ n) from a majority of acceptors, then it sends an accept request to each of those acceptors for a proposal numberedÂ nÂ with a valueÂ <em>v</em>, whereÂ v is the value of the highest-numbered proposal among the responses, or is any value if the responses reported no proposals.</p></li><li><p>If an acceptor receives an accept request for a proposal numberedÂ n, it accepts the proposal unless it has already responded to a prepare request having a number greater thanÂ n.</p></li></ol><p>æ³¨æ„ç»†èŠ‚ï¼š</p><ol><li>Accept è¯·æ±‚ä¸­çš„ value æ˜¯ä¸€é˜¶æ®µè¿”å›æ‰€æœ‰ promised ä¸­ n æœ€å¤§çš„é‚£ä¸ªå€¼ã€‚æ˜¯ promisedâ†’proposal.n çš„ nï¼Œè€Œä¸æ˜¯ promised.n</li><li>acceptor ä¸Š accept å€¼è¿˜æ˜¯ä¼šè¢«ä¿®æ”¹çš„ã€‚</li><li>åœ¨æè®®è¢«å¤§å¤šæ•°é€šè¿‡çš„ä¸€ç¬é—´ï¼Œè¿™ä¸ªå€¼å°±ç¡®å®šä¸‹æ¥äº†ï¼Œå†ä¹Ÿä¸ä¼šè¢«ä¿®æ”¹ã€‚</li></ol><p>å¯¹äºè¯æ˜çš„æ€è·¯æ˜¯è¿™ä¹ˆä¸€ç§æ€è·¯ï¼šè¯æ˜ä¸€ä¸ªå€¼ chosen ä¸ä¼šè¢«ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡åŠ å¼ºçš„æ–¹å¼ã€‚å¦‚æœä¸€ä¸ªå¤§äºå½“å‰æä»ªå·å¹¶ä¸”å€¼ä¸åŒçš„æä»ªï¼Œä¸ä¼šè¢«å‘å‡ºã€‚chosen çš„å€¼è‡ªç„¶å°±ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p><h1 id=multi-paxos-å®ç°æ–¹æ³•>Multi Paxos å®ç°æ–¹æ³•<a hidden class=anchor aria-hidden=true href=#multi-paxos-å®ç°æ–¹æ³•>#</a></h1><p>å¯ä»¥çœ‹åˆ°ï¼ŒBasic Paxos ç®—æ³•åªèƒ½ç¡®å®šä¸€ä¸ªå€¼ï¼ŒåŒæ—¶è¦èµ°ä¸¤è½®æµç¨‹ã€‚ä¸ºäº†åœ¨çœŸå®ç³»ç»Ÿä¸Šå®é™…ä½¿ç”¨èµ·æ¥ï¼Œè¿˜éœ€è¦åšä¸€äº›ä¿®æ”¹ä¼˜åŒ–ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ Basic Paxos ä¸Šå¢åŠ ä¸€ä¸ª Entry ID çš„ç»´åº¦ï¼Œæ¯ä¸ª Entry ä¿å­˜ä¸€ä¸ªå€¼ã€‚åŒæ—¶ï¼Œå¯ä»¥åœ¨ç¬¬ i ä¸ª Entry ä¸­æºå¸¦ä¸Šç¬¬ i+1 ä¸ª Entry çš„ Prepare ä¿¡æ¯ï¼šå½“ $E_i$ è¢« <code>chosen</code> æ—¶ï¼ŒåŒæ—¶è®¤ä¸º $E_i+1$ å·²ç»å®Œæˆäº† <code>prepare</code> æµç¨‹ã€‚</p><h1 id=å·¥ç¨‹å®ç°ä¸Šçš„é—®é¢˜>å·¥ç¨‹å®ç°ä¸Šçš„é—®é¢˜<a hidden class=anchor aria-hidden=true href=#å·¥ç¨‹å®ç°ä¸Šçš„é—®é¢˜>#</a></h1><p>è®ºæ–‡åªæè¿°äº† Paxos ç®—æ³•çš„æµç¨‹å’Œè¯æ˜ï¼Œåœ¨å®é™…å®ç°ä¸Šï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚è¦å¤„ç†ï¼Œä¾‹å¦‚æ€ä¹ˆ CatchUpã€æ€ä¹ˆ GetALLä»¥åŠä¸€äº›ç»†èŠ‚çš„é—®é¢˜ã€‚</p><h2 id=å†™è¯»è¯»é—®é¢˜>å†™è¯»è¯»é—®é¢˜<a hidden class=anchor aria-hidden=true href=#å†™è¯»è¯»é—®é¢˜>#</a></h2><p>å†™è¯»è¯»çš„é—®é¢˜åœºæ™¯ï¼šå‡è®¾ä¸‰æœºæ—¥å¿—éƒ½commitåˆ°äº†Entry 100ï¼Œç„¶åæœºå™¨ Aæ‰§è¡Œ Entry 101 çš„äºŒè½®è¿‡ç¨‹ç„¶åæŒ‚æ‰ã€‚è¿™ä¸ªæ—¶å€™ä¼šè¯»åˆ° 100 çš„å€¼ã€‚ç„¶åæœºå™¨ A æ¢å¤åŒæ­¥çŠ¶æ€åˆ° BCï¼Œåç»­å°±è¯»åˆ°äº† Entry 101ã€‚</p><h2 id=é‡å¤æ‰§è¡Œé—®é¢˜>é‡å¤æ‰§è¡Œé—®é¢˜<a hidden class=anchor aria-hidden=true href=#é‡å¤æ‰§è¡Œé—®é¢˜>#</a></h2><p>é‡å¤æ‰§è¡Œçš„é—®é¢˜åœºæ™¯ï¼šæœºå™¨ A æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚ï¼Œåœ¨æ‰§è¡Œå®Œ Paxos åè¢« chosenï¼Œç„¶åå‘é€å“åº”ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªå“åº”å¯èƒ½å› ä¸ºç½‘ç»œåŸå› æœªå‘åˆ°æˆ–è€…è¶…æ—¶ã€‚ç„¶åå®¢æˆ·ç«¯è¶…æ—¶åé‡å‘è¯·æ±‚åˆ°æœºå™¨ Bã€‚æœºå™¨ B é‡æ–°è·‘ä¸€æ¬¡ Paxos è¿‡ç¨‹ï¼Œç„¶åå›å¤å®¢æˆ·ç«¯ã€‚è¿™å„¿æ›´æ–°è¿‡ç¨‹å°±ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œå¦‚æœæ˜¯æœ‰çŠ¶æ€çš„æ›´æ–°å°±ä¼šæœ‰é—®é¢˜ã€‚</p><p>æ‰€ä»¥è¦è®©è¯·æ±‚å¹‚ç­‰ï¼Œæ–¹æ³•å°±æ˜¯åœ¨è¯·æ±‚ä¸Šå¸¦ä¸Š request IDï¼Œ svr ç«¯æ£€æŸ¥ request ID ã€‚</p><blockquote><p>The request ID is generated by the client and sent together with the write request, and checked by the PaxosStore node to detect potential duplication of actual request handling.</p></blockquote><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/liuchang0812/liuchang0812.github.io/content/posts/tech/os/paxos-note/https:/imgs-1252230511.cos.ap-shanghai.myqcloud.com/2206/paxoslog.png alt=paxoslog></p><h1 id=plogkv-å®ç°é—®é¢˜>PlogKV å®ç°é—®é¢˜<a hidden class=anchor aria-hidden=true href=#plogkv-å®ç°é—®é¢˜>#</a></h1><p>æ–‡ç« åŒæ—¶æåˆ°äº†ä¸€ä¸ª PaxosLog for KV Dataï¼Œå¯ä»¥ä¼˜åŒ–æ‰ DB éƒ¨åˆ†çš„æˆæœ¬ã€‚é‚£ä¹ˆæ­£å¸¸çš„plogå­˜å‚¨çš„keyåº”è¯¥æ˜¯entityidå’Œentryidï¼Ÿæ€ä¹ˆç”¨keyæ¥æŸ¥è¯¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯åªç»´æŠ¤ä¸¤ä¸ªentryï¼Œä¸€ä¸ªæœ€æ–°chosenï¼Œä¸€ä¸ªpendingã€‚æ¯ä¸ª key éƒ½æ˜¯ä¸€ä¸ª paxos å®ä¾‹ã€‚</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/liuchang0812/liuchang0812.github.io/content/posts/tech/os/paxos-note/https:/imgs-1252230511.cos.ap-shanghai.myqcloud.com/2206/plogkv.png alt=plogkv></p><h1 id=å‚è€ƒ>å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#å‚è€ƒ>#</a></h1><ol><li><a href=https://sf-zhou.github.io/paxos/paxos_store_03_consensus.html>https://sf-zhou.github.io/paxos/paxos_store_03_consensus.html</a></li><li><a href=http://www.vldb.org/pvldb/vol10/p1730-lin.pdf>http://www.vldb.org/pvldb/vol10/p1730-lin.pdf</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.liuchang0812.com/tags/algorithm/>Algorithm</a></li><li><a href=https://www.liuchang0812.com/tags/paxos/>Paxos</a></li></ul><nav class=paginav><a class=prev href=https://www.liuchang0812.com/posts/tech/os/libco-usage/><span class=title>Â« Prev</span><br><span>libco usage</span>
</a><a class=next href=https://www.liuchang0812.com/posts/tech/os/cgroup/><span class=title>Next Â»</span><br><span>cgroup usage</span></a></nav></footer><div id=gitalk-container></div><script>const gitalk=new Gitalk({clientID:"402f41759b3537b6c752",clientSecret:"d9558424431bfc3ee18d4b6c6ce7594ef682a701",repo:"liuchang0812.github.io",owner:"liuchang0812",admin:["liuchang0812"],id:location.pathname,distractionFreeMode:!1});gitalk.render("gitalk-container")</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.liuchang0812.com/>â€‹Tech and Text Tales</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>